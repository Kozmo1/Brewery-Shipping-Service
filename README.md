# Brewery-Shipping-Service

Created by Joel Attard, Shahyar Fida, Mike Kraemer, Julia Lebedzeva

This project is a Node.js microservice for managing shipments in an e-commerce application, developed for Open Source Web Programming at Conestoga College. It handles creating shipments, fetching shipment details, updating statuses, retrieving shipments by order, and deleting pending shipments, integrating with the Brewery Database Service and an Order Service via RESTful APIs. Built with TypeScript, Express, and Jest, it emphasizes reliability, security (JWT auth), and testability—achieving 93%+ branch coverage. Environment variables are managed with `dotenv-safe`, loaded from `.env.local` by default or based on `NODE_ENV`. Key configs include the server port (default: 3010), Brewery API URL (default: http://localhost:5089), and JWT secret. The `ShippingController` drives the logic, using Axios for API calls and express-validator for input validation.

To get started, clone the repo from `C:\git\Brewery-Shipping-Service` (or your fork), then run `npm install` to install dependencies like `express`, `axios`, `jsonwebtoken`, `dotenv-safe`, and `express-validator`. For development, add `typescript`, `jest`, `@types/*` packages, and `ts-node` with `npm install --save-dev`. Create a `.env.local` file with `PORT`, `JWT_SECRET`, `BREWERY_API_URL`, and `NODE_ENV`, using `.env.example` as a template. Launch the service with `npm start` (via `ts-node src/index.ts`), or build with `npm run build` and run `node dist/index.js`. Run tests with `npm run test` to execute Jest with coverage—aiming for 100%.

The project structure includes `src/config/config.ts` for env setup, `src/controllers/shippingController.ts` for core logic, `src/middleware/auth.ts` for JWT verification, and `src/index.ts` to start the server. Tests live in `src/config/__tests__/config.test.ts` and `src/controllers/__tests__/shippingController.test.ts`, mocking Axios and express-validator. Below are the endpoints, all under `/shipping` with JSON content type. Routes with auth require a Bearer token in the `Authorization` header.

1. `POST /create` - Creates a shipment. Example input: `{"user_id": 1, "order_id": 1, "address": "123 Main St", "city": "Kitchener", "country": "Canada", "postal_code": "N2H 5H6"}` with header `Authorization: Bearer <token>`. Success response (201): `{"id": 1, "Status": "Pending"}`. Error (400): `{"errors": [{"msg": "Address is required"}]}`.
2. `GET /:id` - Fetches a shipment by ID. Example request: `GET /shipping/1`. Success response (200): `{"id": 1, "UserId": 1, "Status": "Pending"}`. Error (403): `{"message": "Unauthorized"}`.
3. `PUT /update/:id` - Updates shipment status or tracking number. Example input: `{"status": "Shipped", "tracking_number": "XYZ123"}` with header `Authorization: Bearer <token>`. Success response (200): `{"id": 1, "Status": "Shipped"}`. Error (400): `{"errors": [{"msg": "Invalid status"}]}`.
4. `GET /order/:order_id` - Fetches shipment by order ID. Example request: `GET /shipping/order/1`. Success response (200): `{"id": 1, "OrderId": 1}`. Error (403): `{"message": "Unauthorized"}`.
5. `DELETE /:id` - Deletes a pending shipment. Example request: `DELETE /shipping/1`. Success response (200): `{"message": "Shipment deleted successfully"}`. Error (400): `{"message": "Can only delete pending shipments"}`.
